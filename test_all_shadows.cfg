// Comprehensive Shadow Testing Script
// Execute with: /exec test_all_shadows

echo "^3========================================"
echo "^3COMPREHENSIVE SHADOW TESTING"
echo "^3========================================"

// Disable RTX/RT first
seta rtx_enable "0"
seta rt_enable "0"
seta rt_debug "0"

// Enable debug output
seta developer "1"

// Test each shadow mode
echo ""
echo "^2Testing Shadow Mode 0 (None)..."
seta r_shadows "0"
seta cg_shadows "0"
wait 100
echo "^7r_shadows is now:" $r_shadows

echo ""
echo "^2Testing Shadow Mode 1 (Blob)..."
seta r_shadows "1"
seta cg_shadows "1"
wait 100
echo "^7r_shadows is now:" $r_shadows

echo ""
echo "^2Testing Shadow Mode 2 (Stencil)..."
seta r_shadows "2"
seta cg_shadows "2"
seta r_stencilbits "8"
wait 100
echo "^7r_shadows is now:" $r_shadows

echo ""
echo "^2Testing Shadow Mode 3 (Projection)..."
seta r_shadows "3"
seta cg_shadows "3"
wait 100
echo "^7r_shadows is now:" $r_shadows

echo ""
echo "^2Testing Shadow Mode 4 (Advanced Volumes)..."
// Force r_shadows to 4
seta r_shadows "4"
// cg_shadows max is 3
seta cg_shadows "3"
seta r_stencilbits "8"
wait 100
echo "^7r_shadows is now:" $r_shadows

// Ensure dynamic lights are enabled for shadows
seta r_dlightMode "2"
seta r_dynamiclight "1"
seta r_dlightIntensity "2.0"
seta r_dlightScale "1.5"

// Shadow maps
seta r_shadowMapSize "4096"
seta r_shadowMapLod "4"

// Proper lighting
seta r_vertexLight "0"
seta r_ambientScale "0.8"
seta r_directedScale "1.2"
seta r_lightmap "0"

echo ""
echo "^3========================================"
echo "^3SHADOW MODE STATUS:"
echo "^7r_shadows:" $r_shadows
echo "^7cg_shadows:" $cg_shadows
echo "^7r_stencilbits:" $r_stencilbits
echo "^7r_dlightMode:" $r_dlightMode
echo ""
echo "^3EXPECTED BEHAVIOR:"
echo "^7Mode 0: No shadows"
echo "^7Mode 1: Dark blob circles under entities"
echo "^7Mode 2: Sharp stencil shadows"
echo "^7Mode 3: Projected planar shadows"
echo "^7Mode 4: Advanced shadow volumes (if working)"
echo ""
echo "^3TO TEST:"
echo "^7- Fire weapons to create dynamic lights"
echo "^7- Look for console debug output"
echo "^7- Check for shadow rendering"
echo "^3========================================"

// Apply stencil buffer changes
vid_restart